syntax = "proto3";

package TickTrader.Algo.Protocol.Grpc.Lib;

// current version 1.0, syncronize with VersionSpec.cs

import "keys.proto";
import "metadata.proto";
import "config.proto";

service BotAgent
{
	rpc Login (LoginRequest) returns (LoginResponse);

	rpc GetPackageList(PackageListRequest) returns (PackageListResponse);
	rpc GetAccountList(AccountListRequest) returns (AccountListResponse);
	rpc GetBotList(BotListRequest) returns (BotListResponse);
	rpc SubscribeToUpdates(SubscribeToUpdatesRequest) returns (stream UpdateInfo);

	rpc GetAccountMetadata(AccountKey) returns (AccountMetadataInfo);
}

message Request
{
	enum RequestStatus
	{
		SUCCESS = 0;
		INTERNAL_SERVER_ERROR = 1;
	}
}

message LoginRequest
{
	string login = 1;
	string password = 2;
	int32 major_version = 3; // client version
	int32 minor_version = 4; // client version
}

message LoginResponse
{
	enum LoginError
	{
		NONE = 0;
		INVALID_CREDENTIALS = 1;
		VERSION_MISMATCH = 2;
	}

	Request.RequestStatus status = 1;
	LoginError error = 2;
	int32 major_version = 3; // server version
	int32 minor_version = 4; // server version
}

message LogoutRequest
{
}

message LogoutResponse
{
	enum LogoutReason
	{
	    CLIENT_REQUEST = 0;
	    SERVER_LOGOUT = 1;
	}

	Request.RequestStatus status = 1;
	LogoutReason reason = 2;
	string text = 3;
}

message PackageListRequest
{
}

message PackageListResponse
{
	Request.RequestStatus status = 1;
	repeated PackageInfo packages = 2;
}

message AccountListRequest
{
}

message AccountListResponse
{
	Request.RequestStatus status = 1;
	repeated AccountModelInfo accounts = 2;
}

message BotListRequest
{
}

message BotListResponse
{
	Request.RequestStatus status = 1;
	repeated BotModelInfo bots = 2;
}

message SubscribeToUpdatesRequest
{
}

message UpdateInfo
{
	enum UpdateType
	{
	    ADDED = 0;
	    REPLACED = 1;
	    REMOVED = 2;
	}

	UpdateType type = 1;
	oneof update_info
	{
		PackageUpdateInfo package = 5;
		AccountUpdateInfo account = 6;
		AccountStateUpdateInfo account_state = 7;
		BotUpdateInfo bot = 8;
		BotStateUpdateInfo bot_state = 9;
	}
}

message PackageUpdateInfo
{
	PackageInfo package = 1;
}

message AccountUpdateInfo
{
	AccountModelInfo account = 1;
}

message AccountStateUpdateInfo
{
	AccountModelInfo account = 1;
}

message BotUpdateInfo
{
	BotModelInfo bot = 1;
}

message BotStateUpdateInfo
{
	BotModelInfo bot_id = 1;
}